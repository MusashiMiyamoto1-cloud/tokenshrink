version: "3.8"

services:
  # Full test suite
  test-all:
    build:
      context: .
      dockerfile: Dockerfile
    command: pytest tests/ -v --tb=short -x
    environment:
      - TOKENIZERS_PARALLELISM=false

  # Unit tests only (fast)
  test-unit:
    build:
      context: .
      dockerfile: Dockerfile
    command: pytest tests/test_utils.py tests/test_pipeline.py -v --tb=short
    environment:
      - TOKENIZERS_PARALLELISM=false

  # CLI tests
  test-cli:
    build:
      context: .
      dockerfile: Dockerfile
    command: pytest tests/test_cli.py -v --tb=short
    environment:
      - TOKENIZERS_PARALLELISM=false

  # Integration tests
  test-integration:
    build:
      context: .
      dockerfile: Dockerfile
    command: pytest tests/test_integration.py -v --tb=short
    environment:
      - TOKENIZERS_PARALLELISM=false

  # Stress tests
  test-stress:
    build:
      context: .
      dockerfile: Dockerfile
    command: pytest tests/test_stress.py -v --tb=short -s
    environment:
      - TOKENIZERS_PARALLELISM=false
